<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <meta charset="UTF-8">
    <title>Realtime Notification</title>
    <script src="https://cdn.jsdelivr.net/npm/sockjs-client@1/dist/sockjs.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/stompjs@2.3.3/lib/stomp.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        #notifications {
            border: 1px solid #ddd;
            padding: 10px;
            max-width: 400px;
            min-height: 100px;
        }
        .notify {
            background-color: #f1f1f1;
            margin: 5px 0;
            padding: 8px;
            border-radius: 4px;
        }
    </style>
</head>
<body>
<h2>Realtime Notification Test</h2>
<button onclick="connect()">Connect WebSocket</button>
<button onclick="disconnect()">Disconnect WebSocket</button>

<h3>Notifications:</h3>
<div id="notifications"></div>

<script type="text/javascript">
    let stompClient = null;

    function connect() {
        const userId = prompt("Nhập userId của bạn:"); // Nhập userId để subscribe
        const socket = new SockJS('/ws'); // Endpoint backend
        stompClient = Stomp.over(socket);

        stompClient.connect({}, function (frame) {
            console.log('Connected: ' + frame);
            // Subscribe to user-specific notification queue
            stompClient.subscribe('/user/' + userId + '/notification', function (message) {
                showNotification(JSON.parse(message.body));
            });
        }, function (error) {
            console.error('Error: ' + error);
        });
    }

    function disconnect() {
        if (stompClient !== null) {
            stompClient.disconnect();
            console.log("Disconnected");
        }
    }

    function showNotification(notification) {
        const notificationsDiv = document.getElementById('notifications');
        const div = document.createElement('div');
        div.classList.add('notify');
        div.innerText = `[${notification.status}] ${notification.message}`;
        notificationsDiv.prepend(div);
    }
</script>
</body>
</html>